<%- include('navbar', { current: 'products', lang: lang }) %>

<div class="container py-4">
  <!-- Heading with Gradient Background -->
  <div class="d-flex justify-content-between align-items-center mb-3 p-3 rounded" style="background: linear-gradient(90deg, #007BFF, #00CFC8); color: white;">
    <h3 class="mb-0">Products List</h3>
    <form method="GET" action="/admin/product_list">
      <select name="lang" class="form-select" onchange="this.form.submit()" style="width:200px">
        <option value="all" <%= lang==='all' ? 'selected' : '' %>>All Languages</option>
        <option value="en" <%= lang==='en' ? 'selected' : '' %>>English</option>
        <option value="hi" <%= lang==='hi' ? 'selected' : '' %>>Hindi</option>
        <option value="mr" <%= lang==='mr' ? 'selected' : '' %>>Marathi</option>
      </select>
    </form>
  </div>

  <!-- Scrollable Table -->
  <div style="overflow-x:auto;">
    <table id="productsTable" class="table table-bordered table-striped table-hover">
      <thead class="table-dark">
        <tr>
          <th>#</th>
          <th>Image</th>
          <th>Name</th>
          <th>Description</th>
          <th>Dosage</th>
          <th>Features</th>
          <th>Category</th>
          <th>Brand</th>
          <th>Season</th>
          <th>Stock</th>
          <th>Discount</th>
          <th>Variants</th>
          <th>Language</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <% products.forEach((p, index) => { %>
          <tr>
            <td><%= index+1 %></td>
            <td>
              <% if (p.main_image) { %>
                <img src="/uploads/<%= p.main_image %>" width="60" height="60" style="object-fit:cover; border-radius:4px;">
              <% } %>
            </td>
            <td><%= p.product_name %></td>
            <td><%= p.description %></td>
            <td><%= p.dosage %></td>
            <td><%= p.features %></td>
            <td><%= p.category_name %></td>
            <td><%= p.brand_name %></td>
            <td><%= p.season %></td>
            <td><%= p.stock_quantity %></td>
            <td><%= p.discount %> %</td>
            <td><%= p.variants || 'N/A' %></td>
            <td><%= p.language %></td>
            <td class="d-flex gap-1">
              <a href="/admin/product_edit/<%= p.product_id %>" class="btn btn-sm btn-primary" title="Edit">
                <i class="fas fa-edit"></i>
              </a>
              <a href="/admin/product_delete/<%= p.product_id %>" class="btn btn-sm btn-danger" title="Delete" onclick="return confirm('Are you sure?')">
                <i class="fas fa-trash-alt"></i>
              </a>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>

<!-- DataTables CSS/JS -->
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.4/css/dataTables.bootstrap5.min.css">
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/dataTables.bootstrap5.min.js"></script>
<!-- FontAwesome -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<script>
  $(document).ready(function(){
    $('#productsTable').DataTable({
      "order": [[0, "asc"]],
      "scrollX": true
    });
  });
</script>

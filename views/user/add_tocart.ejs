<!-- <%-include("navbar")%> -->


<style>
     /* body { background-color: #f8f9fa; } */
    .cart-header { background: #d6f0d6; padding: 10px; font-size: 18px; font-weight: 600; }
    .cart-item { border-bottom: 1px solid #e0e0e0; padding: 15px 0; }
    .cart-item img { height: 100px; width: 120px; object-fit: contain; border: 1px solid #ddd; background: #fff; }
    .price { font-weight: 600; }
    .old-price { text-decoration: line-through; color: gray; font-size: 14px; }
    .billing-box { background: #fff; border-radius: 8px; padding: 15px; box-shadow: 0 2px 6px rgba(0,0,0,0.1); }
    .billing-box h6 { font-weight: 600; margin-bottom: 15px; }
    .net-price { font-size: 20px; font-weight: 700; color: #000; }
    .proceed-btn { background: #28a745; color: #fff; font-weight: 600; border-radius: 8px; padding: 10px 20px; border: none; }
    .qty-controls { display: flex; align-items: center; }
</style>

<div class="container my-4">
  <div class="cart-header d-flex justify-content-between align-items-center">
    <span><i class="fas fa-shopping-cart"></i> Cart (<span id="cart-count">3</span> Items)</span>
    <i class="fas fa-times"></i>
  </div>

  <div class="row mt-3">
    <!-- LEFT: Cart Items -->
    <div class="col-md-8" id="cart-items">

      <!-- ITEM 1 -->
     <% if(cartItems && cartItems.length > 0) {
   cartItems.forEach(item => { %>
    
<div class="cart-item d-flex align-items-center justify-content-between" data-price="<%= item.discountedPrice %>">
  <div class="d-flex align-items-center">
    <img src="/uploads/<%= item.main_image %>" class="me-3 rounded" alt="<%= item.product_name %>">
    <div>
      <h6 class="mb-1"><%= item.product_name %></h6>
      <small class="text-muted"><%= item.brand_name %> | Size: <%= item.weight %></small><br>

      <!-- Discounted Price -->
      <span class="price">₹<%= item.discountedPrice %></span>

      <!-- Original Price if Discount -->
      <% if (item.discount > 0) { %>
        <span class="old-price">₹<%= item.originalPrice %></span>
      <% } %>

      <div class="mt-2 qty-controls">
        <button class="btn btn-sm btn-success qty-minus">-</button>
        <span class="mx-2 qty"><%= item.quantity %></span>
        <button class="btn btn-sm btn-success qty-plus">+</button>
      </div>
    </div>
  </div>
  <a href="/remove_cart/<%= item.cart_id %>" class="btn btn-sm btn-outline-danger remove-item"><i class="fas fa-trash"></i></a>
</div>




<% }) } else { %>
  <div class="text-center my-5">
    <h5 class="text-muted">Your cart is empty</h5>
    <a href="/product" class="btn btn-primary">Browse Products</a>
  </div>
<% } %>

    </div>

    <!-- RIGHT: Billing Box -->
    <div class="col-md-4">
    <div class="billing-box">
  <div class="alert alert-success p-2">
    <i class="fas fa-tags"></i> Pay Online & Save 3% or More Instantly!
  </div>
  <h6>Billing Details</h6>
<div class="d-flex justify-content-between">
  <span>Total Price</span>
  <span id="total-price">₹<%= totalPrice %></span>
</div>

<div class="d-flex justify-content-between mb-2">
  <span>You Saved</span>
  <span class="text-success" id="you-saved">₹<%= youSaved %></span>
</div>
<hr>
<div class="d-flex justify-content-between align-items-center">
  <span class="net-price" id="net-price">₹<%= net %></span>
  <button class="proceed-btn">Proceed</button>
</div>

 
  
</div>

    </div>
  </div>
</div>

<!-- JS -->
<script>
function toNumber(v){ return parseFloat(String(v).replace(/[^0-9.]/g,'') || 0); }

function updateCart() {
  const items = document.querySelectorAll(".cart-item");
  let total = 0, originalTotal = 0;

  items.forEach(item => {
    const price = toNumber(item.dataset.price);
    const qty = parseInt(item.querySelector(".qty")?.textContent) || 0;

    total += price * qty;

    const oldEl = item.querySelector(".old-price");
    if (oldEl) originalTotal += toNumber(oldEl.textContent) * qty;
    else originalTotal += price * qty;
  });

  const net = total;
  const youSaved = +(originalTotal - total).toFixed(2);

  const setText = (id, val) => { 
    const el = document.getElementById(id); 
    if (el) el.textContent = val; 
  };

  setText("cart-count", items.length);
  setText("total-price", "₹" + total.toFixed(2));
  setText("net-price", "₹" + net.toFixed(2));
  setText("you-saved", "₹" + youSaved.toFixed(2));
}

document.addEventListener("click", function(e){
  const plus = e.target.closest(".qty-plus");
  const minus = e.target.closest(".qty-minus");
  const removeBtn = e.target.closest(".remove-item");

  if (plus) {
    const qtyElem = plus.parentElement.querySelector(".qty");
    qtyElem.textContent = (parseInt(qtyElem.textContent) || 0) + 1;
    updateCart();
  }

  if (minus) {
    const qtyElem = minus.parentElement.querySelector(".qty");
    const current = parseInt(qtyElem.textContent) || 0;
    if (current > 1) qtyElem.textContent = current - 1;
    updateCart();
  }


});

document.addEventListener("DOMContentLoaded", updateCart);
</script>





<%-include("footer")%>

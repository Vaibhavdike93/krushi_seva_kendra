<!-- <%-include("navbar")%> -->
  <style>
       /* product_details page start */
   
   .product-img {
      border-radius: 10px ;
      cursor: pointer;
      transition: 0.3s;
      height:300px;
      width: 300px;
      align-items: center;
      
    }
    .product-card-img{
      float: left;
      height: 100px;
      width:15%;
    }
    .product-card-img :hover{
      border:1px solid black;
    }
    .product-img:hover {
      transform: scale(1.05);
    }
    .stars {
      color: #ffc107;
      font-size: 20px;
    }
    .review-box {
      background: #fff;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
    }
    .usage-list li {
      margin-bottom: 8px;
    }
    .product-badge {
    position: absolute; 
    top: 10px; 
    left: 10px;
    background: #ff6f00;
    color: #fff; 
    padding:11px 15px;
    border-radius: 999px;
    font-size: 15px;
  }
    /* ratings css */
    .star-rating {
      display: flex;
      flex-direction: row-reverse;
      justify-content: center;
      gap: 8px;
      font-size: 2rem;
      cursor: pointer;
    }
    .star {
      color: lightgray;
      transition: color 0.3s;
    }
    .star.active {
      color: gold;
    }
    .reviews {
      text-align: center;
      margin-top: 10px;
      font-size: 1rem;
      color: #444;
    }
    .select{
        width: 150px;
    }
    
  
      
        /* product_details page end */
  </style>
</head>
<body>

<div class="container py-5">
 <div class="container py-5">
  <div class="row g-4">
    <!-- Product Images -->
    <div class="col-md-5">
      <div class="card shadow-sm p-3 position-relative">
        <span class="product-badge"><%= product.discount %>% OFF</span>
        <img src="/uploads/<%= product.main_image %>" class="product-img ms-5 mt-5" id="mainImage" alt="<%= product.product_name %>">
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-7">
      <h3 class="fw-bold"><%= product.product_name %></h3>
      <h5 class="text-muted">
        Category: <%= lang === 'mr' ? product.category_name_mr : lang === 'hi' ? product.category_name_hi : product.category_name_en %>
      </h5>
      <h5 class="text-muted">
        Brand: <%= lang === 'mr' ? product.brand_name_mr : lang === 'hi' ? product.brand_name_hi : product.brand_name_en %>
      </h5>

      <!-- Variant Selection -->
      <div class="mb-3">
        <label for="variantSelect" class="form-label">Select Weight / Variant:</label>
        <select id="variantSelect" class="form-select select">
          <% product.variants.forEach(variant => { %>
            <option value="<%= variant.variant_id %>" 
                    data-original="<%= variant.original_price %>" 
                    data-final="<%= variant.final_price %>" 
                    data-save="<%= variant.discount_amount %>" 
                    <%= variant.variant_id === product.selectedVariant.variant_id ? 'selected' : '' %>>
              <%= variant.weight %> - ₹<%= variant.original_price %>
            </option>
          <% }) %>
        </select>
      </div>

      <div class="mb-3 d-flex align-items-center">
  <label class="me-3 fw-bold">Quantity:</label> 
  <div class="input-group" style="width: 120px;">
    <button type="button" class="btn btn-outline-secondary" id="decreaseQty">-</button>
    <input type="text" class="form-control text-center" id="quantityInput" name="quantity" value="1" min="1">
    <button type="button" class="btn btn-outline-secondary" id="increaseQty">+</button>
  </div>
</div>

      <!-- Price -->
      <h4 class="text-warning fw-bold mt-3">
        Price: ₹<span id="finalPrice"><%= product.selectedVariant.final_price %></span>
        <del class="text-muted" id="originalPrice">₹<%= product.selectedVariant.original_price %></del>
        <small class="text-success" id="savePrice">You save ₹<%= product.selectedVariant.discount_amount %></small>
      </h4>

      <p><strong>Availability:</strong> <%= product.stock_quantity <= 10 ? 'Low Stock' : 'In Stock' %></p>
   <form action="/add_tocart" method="post">
  <input type="hidden" name="product_id" value="<%= product.product_id %>">
  <input type="hidden" name="variant_id" id="variantInput" value="<%= product.selectedVariant.variant_id %>">
  <input type="hidden" id="finalQty" name="quantity" value="1">

  <% if (alreadyInCart) { %>
    <a href="/add_tocart" class="btn btn-secondary btn-lg">Already in Cart</a>
  <% } else { %>
    <button type="submit" class="btn btn-warning btn-lg">Add to Cart</button>
  <% } %>
</form>



      <!-- <a href="/add_tocart/<%=product.product_id%>" class="btn btn-warning btn-lg">Add to Cart</a> -->
      <a href="/checkout/<%=product.product_id%>" class="btn btn-outline-success btn-lg">Buy Now</a>

      <hr>
      <h5>Description</h5>
      <p><%= product.description %></p>

      <!-- <h5>Usage Instructions</h5> -->
      <ul class="usage-list">
        <% if(product.usage && product.usage.length) { %>
          <% product.usage.split('|').forEach(u => { %>
            <li><%= u %></li>
          <% }) %>
        <% } %>
      </ul>

      <h5>Usage Instructions & Dosage</h5>
      <ul class="usage-list">
        <% product.dosage.forEach(d => { %>
          <li><%= d %></li>
        <% }) %>
      </ul>

      <h5>Features & Benefits</h5>
      <h6>Features</h6>
      <ul>
        <% product.features.forEach(f => { %>
          <li><%= f %></li>
        <% }) %>
      </ul>
     
      </ul>
    </div>
  </div>
</div>


  <hr class="my-5">
      <!-- Review Box -->
      <div class="review-box">
        <div class="d-flex justify-content-between">
           <div class="d-flex align-items-center mb-2">
      <img src="https://i.pravatar.cc/40?img=1" alt="Rahul Sharma" class="rounded-circle me-2" width="40" height="40">
      <h6 class="mb-0 fw-bold">Rahul Sharma</h6>
    </div>
          <span>
            <i class="stars">&#9733;</i>
            <i class="stars">&#9733;</i>
            <i class="stars">&#9733;</i>
            <i class="stars">&#9733;</i>
            <i class="stars">&#9734;</i>
          </span>
        </div>
        <p class="mt-2">Very effective fertilizer! My tomato plants grew healthier and faster.</p>
      </div>

      <div class="review-box">
        <div class="d-flex justify-content-between">
          <div class="d-flex align-items-center mb-2">
      <img src="https://i.pravatar.cc/40?img=2" alt="Sneha Patil" class="rounded-circle me-2" width="40" height="40">
      <h6 class="mb-0 fw-bold">Sneha Patil</h6>
    </div>
          <span>
            <i class="stars">&#9733;</i>
            <i class="stars">&#9733;</i>
            <i class="stars">&#9733;</i>
            <i class="stars">&#9734;</i>
            <i class="stars">&#9734;</i>
          </span>
        </div>
        <p class="mt-2">Good product, but delivery was a bit late. Overall, happy with the results.</p>
      </div>

      <!-- Add Review -->
      <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#reviewModal">Write a Review</button>
    </div>
  </div>
</div>

<!-- Review Modal -->
<div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Write a Review</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Your Name</label>
          <input type="text" class="form-control" required>
        </div>
        <div class="mb-3">
  <label class="form-label">Rating</label>
  <div class="star-rating" id="stars">
    <span class="star" data-value="5">&#9733;</span>
    <span class="star" data-value="4">&#9733;</span>
    <span class="star" data-value="3">&#9733;</span>
    <span class="star" data-value="2">&#9733;</span>
    <span class="star" data-value="1">&#9733;</span>
  </div>
  <div class="reviews" id="reviews">No reviews yet</div>
</div>
        <div class="mb-3">
          <label class="form-label">Review</label>
          <textarea class="form-control" rows="3" required></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" type="submit">Submit Review</button>
      </div>
    </form>
  </div>
</div>

<!-- Image Modal -->
<div class="modal fade" id="imageModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content bg-transparent border-0">
      <div class="modal-body p-0 text-center">
        <img id="modalImage" src="" class="img-fluid rounded" alt="Product Image">
      </div>
      <button type="button" class="btn-close position-absolute top-0 end-0 m-3" data-bs-dismiss="modal" aria-label="Close"></button>
    </div>
  </div>
</div>


<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function changeImage(img) {
    document.getElementById("mainImage").src = img.src;
  }
</script>
<!--reviews-->
<script>
  const stars = document.querySelectorAll(".star");
  const reviewText = document.getElementById("reviews");
  let rating = 0;

  stars.forEach(star => {
    star.addEventListener("click", () => {
      rating = star.getAttribute("data-value");
      updateStars(rating);
      reviewText.textContent = You rated ${rating} star${rating > 1 ? "s" : ""};
    });
  });

  function updateStars(rating) {
    stars.forEach(star => {
      if (star.getAttribute("data-value") <= rating) {
        star.classList.add("active");
      } else {
        star.classList.remove("active");
      }
    });
  }
</script>
<script>
document.getElementById("variantSelect").addEventListener("change", function() {
    const selectedOption = this.options[this.selectedIndex];
    document.getElementById("finalPrice").innerText = selectedOption.getAttribute("data-final");
    document.getElementById("originalPrice").innerText = selectedOption.getAttribute("data-original");
    document.getElementById("savePrice").innerText = "You save ₹" + selectedOption.getAttribute("data-save");

    document.getElementById("variantInput").value = selectedOption.value;
});

    document.getElementById("mainImage").addEventListener("click", function() {
        const images = document.querySelectorAll(".product-card-img img");
        images.forEach(img => {
        img.addEventListener("click", function() {
            changeImage(this);
        });
        });
    });
</script>

<script>
  // Main image click
  const mainImage = document.getElementById("mainImage");
  const modalImage = document.getElementById("modalImage");
  const imageModal = new bootstrap.Modal(document.getElementById('imageModal'));

  mainImage.addEventListener("click", () => {
    modalImage.src = mainImage.src;
    imageModal.show();
  });

  // Gallery images click (जर असतील तर)
  const galleryImages = document.querySelectorAll(".product-card-img img");
  galleryImages.forEach(img => {
    img.addEventListener("click", function() {
      modalImage.src = this.src;
      imageModal.show();
    });
  });
</script>


<script>
  const qtyInput = document.getElementById("quantityInput");
  const finalQty = document.getElementById("finalQty");
  const decreaseBtn = document.getElementById("decreaseQty");
  const increaseBtn = document.getElementById("increaseQty");

  increaseBtn.addEventListener("click", () => {
    let qty = parseInt(qtyInput.value) || 1;
    qty++;
    qtyInput.value = qty;
    finalQty.value = qty;
  });

  decreaseBtn.addEventListener("click", () => {
    let qty = parseInt(qtyInput.value) || 1;
    if (qty > 1) qty--;
    qtyInput.value = qty;
    finalQty.value = qty;
  });

  qtyInput.addEventListener("input", () => {
    let qty = parseInt(qtyInput.value) || 1;
    if (qty < 1) qty = 1;
    qtyInput.value = qty;
    finalQty.value = qty;
  });
</script>


<%-include("footer")%>

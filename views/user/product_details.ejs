<%- include("navbar.ejs") %>

<style>
  /* product_details page start */
  .pd-img {
    border-radius: 10px;
    cursor: pointer;
    transition: 0.3s;
    height: 300px;
    width: 300px;
    align-items: center;
  }
  .pd-img:hover {
    transform: scale(1.05);
  }
  .pd-stars {
    color: #ffc107;
    font-size: 20px;
  }
  .pd-review-box {
    background: #fff;
    border-radius: 10px;
    padding: 15px;
    margin-bottom: 10px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
  }
  .pd-usage-list li {
    margin-bottom: 8px;
  }
  .pd-badge {
    position: absolute;
    top: 10px;
    left: 10px;
    background: #ff6f00;
    color: #fff;
    padding: 11px 15px;
    border-radius: 999px;
    font-size: 15px;
  }
  /* ratings css */
  .pd-star-rating {
    display: flex;
    flex-direction: row-reverse;
    justify-content: center;
    gap: 8px;
    font-size: 2rem;
    cursor: pointer;
  }
  .pd-star {
    color: lightgray;
    transition: color 0.3s;
  }
  .pd-star.active {
    color: gold;
  }
  .pd-reviews-text {
    text-align: center;
    margin-top: 10px;
    font-size: 1rem;
    color: #444;
  }
  /* product_details page end */
</style>

<div class="container py-5">
  <div class="row g-4">
    <!-- Product Images -->
    <div class="col-md-5">
      <div class="card shadow-sm p-3 position-relative">
        <span class="pd-badge"><%= product.discount %>% OFF</span>
        <img src="/uploads/<%= product.main_image %>" class="pd-img ms-5 mt-5" id="mainImage" alt="<%= product.product_name %>">
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-7">
      <h3 class="fw-bold"><%= product.product_name %></h3>
      <h5 class="text-muted">
        Category: <%= lang === 'mr' ? product.category_name_mr : lang === 'hi' ? product.category_name_hi : product.category_name_en %>
      </h5>
      <h5 class="text-muted">
        Brand: <%= lang === 'mr' ? product.brand_name_mr : lang === 'hi' ? product.brand_name_hi : product.brand_name_en %>
      </h5>

      <!-- Variant Selection -->
      <div class="mb-3">
        <label for="variantSelect" class="form-label">Select Weight / Variant:</label>
        <select id="variantSelect" class="form-select">
          <% product.variants.forEach(variant => { %>
            <option value="<%= variant.variant_id %>" 
                    data-original="<%= variant.original_price %>" 
                    data-final="<%= variant.final_price %>" 
                    data-save="<%= variant.discount_amount %>" 
                    <%= variant.variant_id === product.selectedVariant.variant_id ? 'selected' : '' %>>
              <%= variant.weight %> - ₹<%= variant.original_price %>
            </option>
          <% }) %>
        </select>
      </div>

      <!-- Price -->
      <h4 class="text-warning fw-bold mt-3">
        Price: ₹<span id="finalPrice"><%= product.selectedVariant.final_price %></span>
        <del class="text-muted" id="originalPrice">₹<%= product.selectedVariant.original_price %></del>
        <small class="text-success" id="savePrice">You save ₹<%= product.selectedVariant.discount_amount %></small>
      </h4>

      <p><strong>Availability:</strong> <%= product.stock_quantity <= 10 ? 'Low Stock' : 'In Stock' %></p>
      <button class="btn btn-warning btn-lg">Add to Cart</button>
      <button class="btn btn-outline-success btn-lg">Buy Now</button>

      <hr>
      <h5>Description</h5>
      <p><%= product.description %></p>

      <h5>Usage Instructions</h5>
      <ul class="pd-usage-list">
        <% if(product.usage && product.usage.length) { %>
          <% product.usage.split('|').forEach(u => { %>
            <li><%= u %></li>
          <% }) %>
        <% } %>
      </ul>

      <h5>Dosage</h5>
      <ul class="pd-usage-list">
        <% product.dosage.forEach(d => { %>
          <li><%= d %></li>
        <% }) %>
      </ul>

      <h5>Features & Benefits</h5>
      <h6>Features</h6>
      <ul>
        <% product.features.forEach(f => { %>
          <li><%= f %></li>
        <% }) %>
      </ul>
    </div>
  </div>

  <hr class="my-5">

  <!-- Review Box -->
  <div class="pd-review-box">
    <div class="d-flex justify-content-between">
      <div class="d-flex align-items-center mb-2">
        <img src="https://i.pravatar.cc/40?img=1" alt="Rahul Sharma" class="rounded-circle me-2" width="40" height="40">
        <h6 class="mb-0 fw-bold">Rahul Sharma</h6>
      </div>
      <span>
        <i class="pd-stars">&#9733;</i>
        <i class="pd-stars">&#9733;</i>
        <i class="pd-stars">&#9733;</i>
        <i class="pd-stars">&#9733;</i>
        <i class="pd-stars">&#9734;</i>
      </span>
    </div>
    <p class="mt-2">Very effective fertilizer! My tomato plants grew healthier and faster.</p>
  </div>

  <div class="pd-review-box">
    <div class="d-flex justify-content-between">
      <div class="d-flex align-items-center mb-2">
        <img src="https://i.pravatar.cc/40?img=2" alt="Sneha Patil" class="rounded-circle me-2" width="40" height="40">
        <h6 class="mb-0 fw-bold">Sneha Patil</h6>
      </div>
      <span>
        <i class="pd-stars">&#9733;</i>
        <i class="pd-stars">&#9733;</i>
        <i class="pd-stars">&#9733;</i>
        <i class="pd-stars">&#9734;</i>
        <i class="pd-stars">&#9734;</i>
      </span>
    </div>
    <p class="mt-2">Good product, but delivery was a bit late. Overall, happy with the results.</p>
  </div>

  <!-- Add Review -->
  <button class="btn btn-primary mt-3" data-bs-toggle="modal" data-bs-target="#reviewModal">Write a Review</button>
</div>

<!-- Review Modal -->
<div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Write a Review</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div class="mb-3">
          <label class="form-label">Your Name</label>
          <input type="text" class="form-control" required>
        </div>
        <div class="mb-3">
          <label class="form-label">Rating</label>
          <div class="pd-star-rating" id="stars">
            <span class="pd-star" data-value="5">&#9733;</span>
            <span class="pd-star" data-value="4">&#9733;</span>
            <span class="pd-star" data-value="3">&#9733;</span>
            <span class="pd-star" data-value="2">&#9733;</span>
            <span class="pd-star" data-value="1">&#9733;</span>
          </div>
          <div class="pd-reviews-text" id="reviews">No reviews yet</div>
        </div>
        <div class="mb-3">
          <label class="form-label">Review</label>
          <textarea class="form-control" rows="3" required></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-success" type="submit">Submit Review</button>
      </div>
    </form>
  </div>
</div>

<!-- Bootstrap JS -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<!-- Reviews Script -->
<script>
  const stars = document.querySelectorAll(".pd-star");
  const reviewText = document.getElementById("reviews");
  let rating = 0;

  stars.forEach(star => {
    star.addEventListener("click", () => {
      rating = star.getAttribute("data-value");
      updateStars(rating);
      reviewText.textContent = `You rated ${rating} star${rating > 1 ? "s" : ""}`;
    });
  });

  function updateStars(rating) {
    stars.forEach(star => {
      if (parseInt(star.getAttribute("data-value")) <= rating) {
        star.classList.add("active");
      } else {
        star.classList.remove("active");
      }
    });
  }
</script>

<%- include("footer.ejs") %>
